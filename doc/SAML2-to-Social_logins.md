![](images/saml2-to-social_login.png "SAML2-to-Social_logins proxy overview image")

1. When the metadata generation script is executed it gathers the metadata from all the backend modules
1. The metadata generation script creates a new metadata file for every identity provider
1. The service provider needs to know which identity provider it want to authenticate at. How this is decided is out of scope for this application.
1. The SAML2 mirror front could handle the dynamic endpoint URL:s generated by the metadata generation script. Based on the url the request is forwarded to the corresponding backend module
1. The backend communicates with the identity provider and receives user information  
1. The response is converted to an internal representation and returned to the frontend module
1. The response is returned to the service provider

# Installation
After following the [installation instructions](README.md#installation), the proxy must
be configured with a SAML2 frontend and an SAML2 backend.


# Configuration

1. Copy the necessary base configurations from the `<satosa_path>/example` directory:
   ```bash
   mkdir -p SAML2-to-Social_logins/plugins
   cp example/{proxy_conf.yaml.example,internal_attributes.yaml.example} SAML2-to-Social_logins/ # proxy application and its config
   cp example/plugins/frontends/saml2_frontend.yaml.example SAML2-to-Social_logins/plugins/
   cp example/plugins/backends/saml2_backend.yaml.example SAML2-to-Social_logins/plugins/
   ```
   
1. Configure the proxy:
  1. Rename `proxy_conf.yaml.example` to `proxy_conf.yaml`:
     ```bash
     mv proxy_conf.yaml.example proxy_conf.yaml
     ```

  1. Edit the necessary proxy configuration parameters, see the [SATOSA proxy
     configuration](README.md#proxy_conf) section of the proxy configuration instructions
     for more information.
     To specify the necessary plugins make sure to include the following
     configuration parameter values:
     ```yaml  
     PLUGIN_PATH:
       - plugins
     BACKEND_MODULES:
       - saml2_backend
     FRONTEND_MODULES:
       - saml2_frontend
     ```

1. Configure the attribute mapping:
  1. Rename `internal_attributes.yaml.example` to `internal_attributes.yaml`:
     ```bash
     mv internal_attributes.yaml.example internal_attributes.yaml
     ```

  1. Map the necessary attributes, see the [Attribute mapping configuration](README.md#attr_map)
     section of the proxy configuration instructions for more
     information.

1. Configure the plugins
  1. Rename `plugins/saml2_frontend.yaml.example` to `plugins/saml2_frontend.yaml`
     and `plugins/saml2_backend.yaml.example` to `plugins/saml2_backend.yaml`
     ```bash
     mv plugins/saml2_frontend.yaml.example plugins/saml2_frontend.yaml
     mv plugins/saml2_backend.yaml.example plugins/saml2_backend.yaml
     ```
    
  1. Open saml2_frontend.yaml; Change the **module** attribute to the **satosa.frontends.saml2.SamlMirrorFrontend** 
  1. Specify the necessary configuration parameters, see the [Plugins](README.md#plugins) section
     of the proxy configuration instructions for more information.

1. Generate the SAML metadata, see the [SAML metadata](README.md#saml_metadata) section of the
   proxy configuration instructions for more information.
   ```bash
   make_saml_metadata.py proxy_conf.yaml
   ```

# Run
1. Start the proxy application, see the [Running the proxy application](README.md#run) section of
   the proxy configuration instructions for more information.

